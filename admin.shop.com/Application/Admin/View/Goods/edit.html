<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ECSHOP 管理中心 - 添加新商品 </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="__CSS__/general.css" rel="stylesheet" type="text/css" />
    <link href="__CSS__/main.css" rel="stylesheet" type="text/css" />
    <link href="__ZTREE__/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" type="text/css"/>
    <link href="__CSS__/common.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<h1>
    <span class="action-span"><a href="{:U('index')}">商品列表</a>
    </span>
    <span class="action-span1"><a href="__GROUP__">ECSHOP 管理中心</a></span>
    <span id="search_id" class="action-span1"> - 添加新商品 </span>
    <div style="clear:both"></div>
</h1>
<style type="text/css">
    #tabbar-div p{
        float:left;
    }
</style>
<div class="tab-div">
    <div id="tabbar-div">
            <span class="tab-front" id="general_tab" >通用信息</span>
            <span class="tab-back" id="goods_intro">商品简介</span>
            <span class="tab-back" id="member_price">会员价格</span>
            <span class="tab-back" id="goods_photo">商品相册</span>
    </div>
    <div id="tabbody-div">
        <form enctype="multipart/form-data" action="{:U('add')}" method="post">
            <table width="90%" id="general_tab_table" style="display:block;" align="center">
                <tr>
                    <td class="label">商品名称：</td>
                    <td><input type="text" name="name" value="{:isset($result['name'])?$result['name']:''}" size="30" />
                        <span class="require-field">*</span>
                        <input type="hidden" name="id" id="goods_id" value="{:isset($result['id'])?$result['id']:0}" />
                    </td>
                </tr>
                <tr>
                    <td class="label">商品货号： </td>
                    <td>
                        <input type="text" name="goods_sn" value="{:isset($result['goods_sn'])?$result['goods_sn']:''}" size="20"/>
                        <span class="require-field">*</span>
                    </td>
                </tr>
                <tr>
                    <td class="label">商品分类：</td>
                    <td>
                        <input type="text" id="goods_category_text" value="默认为顶级分类" disabled/>
                        <input type="hidden" name="goods_category" id="goods_category_id"/>
                        <span class="require-field">*</span>
                    </td>
                </tr>
                <tr>
                    <td class="label"></td>
                    <td>
                        <style type="text/css">
                            .ztree{
                                margin-top: 10px;
                                border: 1px solid #617775;
                                background: #f0f6e4;
                                width: 220px;
                                height: 200px;
                                overflow-y: scroll;
                                overflow-x: auto;
                            }
                        </style>
                        <div class="zTreeDemoBackground left">
                            <ul id="treeDemo" class="ztree"></ul>
                        </div>
                    </td>
                </tr>



                <tr>
                    <td class="label">商品品牌：</td>
                    <td>
                        <select name="goods_brand" id="goods_brand" value="{:isset($result['goods_brand'])?$result['goods_brand']:''}">
                            <option value="0">--请选择--</option>
                            <volist name="rows" id="row">
                                <option value="{$row.id}">{$row.name}</option>
                            </volist>
                        </select>
                        <span class="require-field">*</span>
                    </td>
                </tr>
                <tr>
                    <td class="label">本店售价：</td>
                    <td>
                        <input type="text" name="shop_price" value="{:isset($result['shop_price'])?$result['shop_price']:''}" size="20"/>
                        <span class="require-field">*</span>
                    </td>
                </tr>
                <tr>
                    <td class="label">市场售价：</td>
                    <td>
                        <input type="text" name="market_price" value="{:isset($result['market_price'])?$result['market_price']:''}" size="20" />
                        <span class="require-field">*</span>
                    </td>
                </tr>
                <tr>
                    <td class="label">商品数量：</td>
                    <td>
                        <input type="text" name="goods_mount" size="8" value="{:isset($result['goods_mount'])?$result['goods_mount']:''}"/>
                        <span class="require-field">*</span>
                    </td>

                </tr>
                <tr>
                    <td class="label">是否显示：</td>
                    <td>
                        <input type="radio" name="status" value="1" id="yes" checked/> 是
                        <input type="radio" name="status" value="0" id="no"/> 否
                    </td>
                </tr>
                <tr>
                    <td class="label">加入推荐：</td>
                    <td>
                        <input type="checkbox" name="is_recommend[0]" value="1" id="good"/> 精品
                        <input type="checkbox" name="is_recommend[1]" value="1" id="new"/> 新品
                        <input type="checkbox" name="is_recommend[2]" value="1" id="hot"/> 热销
                    </td>
                </tr>


                <tr>
                    <td class="label">商品图片：</td>
                    <td>
                        <input type="file"  id="logo_upload" size="35" />
                        <input type="hidden" name="goods_logo" id="goods_log" value=""/>

                        <div class="upload-img-box" style="display: none">
                            <div class="upload-pre-item">
                                <img src="">
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
            <table width="90%" id="goods_intro_table" style="display:none;" align="center">
                <tr>
                    <td class="label">商品名称1：</td>
                    <td><input type="text" name="goods_name" value=""size="30" />
                        <span class="require-field">*</span></td>
                </tr>
            </table>
            <table width="90%" id="member_price_table" style="display:none;" align="center">
                <tr>
                    <td class="label">商品名称2：</td>
                    <td><input type="text" name="goods_name" value=""size="30" />
                        <span class="require-field">*</span></td>
                </tr>
            </table>
            <table width="90%" id="goods_photo_table" style="display:none;" align="center">
                <tr>
                    <td class="label">商品名称3：</td>
                    <td><input type="text" name="goods_name" value=""size="30" />
                        <span class="require-field">*</span></td>
                </tr>
            </table>
            <div class="button-div">
                <input type="submit" value=" 确定 " class="button"/>
                <input type="reset" value=" 重置 " class="button" />
            </div>
        </form>
    </div>
</div>

<script type="text/javascript" src="__JS__/jquery-1.11.2.js"></script>
<script type="text/javascript" src="__JS__/common.js"></script>
<script type="text/javascript" src="__ZTREE__/js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript"src="__UPLOAD__/jquery.uploadify.min.js"></script>

<script type="text/javascript">
    var setting={
        data:{
            simpleData:{
                enable:true,
                pIdKey:"parent_id"
            }
        },
        callback:{
            onClick:function(event, treeId, treeNode){
                $("#goods_category_text").val(treeNode.name);
                $("#goods_category_id").val(treeNode.id);
            }
        }
    };

    var zNodes={$zNodes};

    $(function(){
        /**********1.实现商品添加页面不同模块切换的功能****************/
       $('#tabbar-div').children('span').click(function(){
           var id='#'+$(".tab-front").attr("id")+"_table";
           var this_id='#'+$(this).attr('id')+"_table";
           $(".tab-front").removeClass('tab-front').addClass('tab-back');
           $(id).css("display","none");
           $(this).removeClass('tab-back').addClass('tab-front');
           $(this_id).css('display','block');
       });


        /**********2.1 实现商品分类树状结构展示的功能****************/
        var zTreeObj=$.fn.zTree.init($('#treeDemo'), setting, zNodes);
        zTreeObj.expandAll(true);
        <notempty name="result">
            var id={$result.goods_category};
            var data=zTreeObj.getNodeByParam('id',id,null);
            $('#goods_category_text').val(data.name);
            $('#goods_category_id').val(data.id);

           /*****************2.2 编辑回显,选中商品品牌*********************/
            var brand_id=$('#goods_brand').children('option').each(function(){
               if($(this).val()=={$result['goods_brand']}){
                   $(this).attr('selected','selected');
               }
               /*****************2.3 编辑回显,选中是否显示*********************/
            var status={$result.status};
            if(status==1){
                $('#yes').attr('checked','checked');
                $('#no').removeAttr('checked');
            }else{
                $('#yes').removeAttr('checked');
                $('#no').attr('checked','checked');
            }
           });
    /*****************2.4 编辑回显,选中是否推荐*********************/
           var recommend_id={$result.is_recommend};
           if(recommend_id%2==1){
               $('#good').attr('checked','checked');
           }
           if((recommend_id>>1)%2==1){
               $('#new').attr('checked','checked');
           }
           if((recommend_id>>2)%2==1){
               $('#hot').attr('checked','checked');
           }
    /*****************2.5 编辑回显,显示商品图片*********************/
           var pic_add="/Uploads/{$result.goods_logo}";
           $('.upload-img-box').css('display','block');
           $('.upload-pre-item').children('img').attr('src',pic_add);
           $('#goods_log').val('{$result.goods_logo}');
        </notempty>


        /*************3.实现uploadify上传插件的功能****************/
        $("#logo_upload").uploadify({
            height:30, //上传标签的高度
            width:120,  //上传标签的宽度
            buttonText:"上传图片",  //上传标签上的文字说明
            formData:{'dir':'Goods/','root':'./Uploads/'},
            swf:"__UPLOAD__/uploadify.swf",  //flash插件的地址
            uploader:"{:U('Upload/index')}", //文件上传到的php页面
            fileObjName:'fileData',
            onUploadSuccess:function(file,data,response){
                console.debug(data);
                $('.upload-img-box').css('display','block');
                $('#goods_log').val(data);
                $('.upload-pre-item').children('img').prop('src','/Uploads/'+data);


            },
            'onUploadError' : function(file, errorCode, errorMsg, errorString) {}

        });








    });

</script>
</body>
</html>